<html>
  <head>
    <link rel="stylesheet" href="./styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cabin:wght@400;600&display=swap" rel="stylesheet">
    <title>Why is Eula best girl?</title>
  </head>
  <body>
    <div class="content">
      <div class="header">
        <div class="title">Why is Eula best girl?</div>
        <a href="./sneeze.html"><button class="button big" style="margin-bottom: 100px;">Find out</button></a>
      </div>
      <div class="eula"></div>
      <div class="simon">
          <div class="scroll">&darr; Scroll down to play Simon Says &darr;</div>
          <div class="buttons">
            <button class="button red" id="redButton"></button>
            <button class="button green" id="greenButton"></button>
            <button class="button blue" id="blueButton"></button>
            <button class="button yellow" id="yellowButton"></button>
          </div>
          <button class="button big" id="playButton">Play</button>
          <div class="score" id="score"></div>
          <div class="gameOver" id="gameOver">Game Over</div>
      </div>
    </div>
  </body>
  <script>
    let redButton = document.getElementById("redButton");
    let greenButton = document.getElementById("greenButton");
    let blueButton = document.getElementById("blueButton");
    let yellowButton = document.getElementById("yellowButton");
    let playButton = document.getElementById("playButton");
    let gameOver = document.getElementById("gameOver");

    let correctSequence = [];
    let userSequence = [];
    let score = -1;

    redButton.disabled = true;
    greenButton.disabled = true;
    blueButton.disabled = true;
    yellowButton.disabled = true;
    gameOver.style.display = "none";

    redButton.addEventListener("click", () => {
      flashColor(0);
      checkColor(0);
    });
    greenButton.addEventListener("click", () => {
      flashColor(1);
      checkColor(1);
    });
    blueButton.addEventListener("click", () => {
      flashColor(2);
      checkColor(2);
    });
    yellowButton.addEventListener("click", () => {
      flashColor(3);
      checkColor(3);
    });
    playButton.addEventListener("click", () => {
      play();
    });

    function play() {
      playButton.disabled = true;
      playButton.classList.add("disabled");
      gameOver.style.display = "none";
      correctSequence = [];
      score = -1;
      newRound();
    }

    function newRound() {
      userSequence = [];
      score += 1;
      document.getElementById("score").innerHTML = score;

      redButton.disabled = true;
      greenButton.disabled = true;
      blueButton.disabled = true;
      yellowButton.disabled = true;

      let rand = Math.floor(Math.random() * 4);
      console.log(rand);
      correctSequence.push(rand);
      console.log(correctSequence);
      for (let i = 0; i < correctSequence.length; i++) {
        setTimeout(() => {
          flashColor(correctSequence[i]);
        }, (i + 1) * 1000);
      }
      setTimeout(() => {
        redButton.disabled = false;
        greenButton.disabled = false;
        blueButton.disabled = false;
        yellowButton.disabled = false;
      }, correctSequence.length * 1000);
    }

    function flashColor(color) {
      switch (color) {
        case (0):
          redButton.classList.add("lit");
          setTimeout(() => {
            redButton.classList.remove("lit");
          }, 0);
          break;
        case (1):
          greenButton.classList.add("lit");
          setTimeout(() => {
            greenButton.classList.remove("lit");
          }, 0);
          break;
        case (2):
          blueButton.classList.add("lit");
          setTimeout(() => {
            blueButton.classList.remove("lit");
          }, 0);
          break;
        case (3):
          yellowButton.classList.add("lit");
          setTimeout(() => {
            yellowButton.classList.remove("lit");
          }, 0);
          break;
      }
    }

    function checkColor(color) {
      userSequence.push(color);
      if ((userSequence.length == correctSequence.length) && checkEqual()) {
        newRound();
      } else if (!checkEqual()) {
        playButton.disabled = false;
        playButton.classList.remove("disabled");
        gameOver.style.display = "block";
      }
    }

    function checkEqual() {
      for (let i = 0; i < userSequence.length; i++) {
        if (userSequence[i] != correctSequence[i]) {
          return false;
        }
      }
      return true;
    }

  </script>
</html>
